<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  
  <title>Como acessar os Dados Abertos da Câmara dos Deputados usando Python</title>
<link href="http://carneiro.blog.br/um/theme/css/style.css" rel="stylesheet" type="text/css" media="screen" />
<link href="http://carneiro.blog.br/um/" type="application/atom+xml" rel="alternate" title="Só mais um Carneiro ATOM Feed" />
  
  <!--[if IE]>
  <style type="text/css"> 
  .twoColFixRtHdr #mainContent { zoom: 1; }
  </style>
  <![endif]-->

</head>

<body>

<div id="container">

  <div id="header">
  <h1><a href="http://carneiro.blog.br/um">Só mais um Carneiro</h1>
  
  </div><!-- end #header -->
  
  <div id="topMenu">
  
    <ul>
    	<li><a href="http://carneiro.blog.br/um">Home</a></li>
        <li>&ndash;</li>
        <li><a href="http://carneiro.blog.br/um/archives.html">Archives</a></li>
        
    </ul>
  
  </div><!-- end #topMenu -->

  <div id="sidebar">
	<h3>Páginas</h3>
	<ul>
	</ul>
    <h3>Categorias</h3>
    <ul>
		 <li class="active"><a href="http://carneiro.blog.br/um/category/misc.html">misc</a></li>
	</ul>
	<li>
		<h3>Diga-me com quem andas...</h3>
		<ul>
                    <li><a href="http://calango.club/">Calango Hacker Clube</a></li>
                    <li><a href="http://www.blogdoje.com.br/">Jerônimo</a></li>
                    <li><a href="http://tecno-artesanato.tumblr.com/">Phil Jones</a></li>
                    <li><a href="http://getpelican.com/">Pelican</a></li>
                    <li><a href="http://python.org/">Python.org</a></li>
		</ul>
	</li>
<li>
        <h3>Tags</h3>
        <ul>
        </ul>
</li>
    
  
  </div><!-- end #sidebar -->

  <div id="mainContent">
  	
 


<div class="blogItem">
    
      <h2><a href="http://carneiro.blog.br/um/Como-acessar-os-Dados-Abertos-da-Câmara-dos-Deputados-usando-Python.html">Como acessar os Dados Abertos da Câmara dos Deputados usando Python</a></h2>
      <h3>Le Seg 16 junho 2014</h3>
      
  <p>A Câmara dos Deputados tem um serviço muito interessante chamado <a href="http://www2.camara.leg.br/transparencia/dados-abertos">Dados
Abertos</a>. A ideia
é que qualquer cidadão tenha acesso a informações sobre Deputados e
sobre a tramitação de propostas de leis. Você não precisa se cadastrar
nem nada, basta saber montar suas consultas. E foi para ensinar a
fazê-lo que resolvi escrever este post.</p>
<style>  pre {background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;}  code {color: black; word-wrap: normal;} </style>

<p>O serviço Dados Abertos é um WebService. Um webservice é como se fosse
um sistema de informação sem telas. Você pode consultar o que quiser,
mas não tem um formulário para preencher o que quer. E o retorno do
sistema não é uma planilha bonitinha nem um relatório em PDF, é só um
monte de informação que você mesmo tem que tratar.</p>
<p>Eu resolvi usar python para fazer minhas pesquisas. Eu estou usando a
biblioteca <a href="https://fedorahosted.org/suds/">suds</a>, que é um cliente leve
de webservices para python.</p>
<p>Para instalar no linux, usei:</p>
<div class="highlight"><pre>$  sudo pip install suds
</pre></div>


<p>Para poder fazer isso, você tem que ter o
<a href="https://www.python.org/">python</a> e o
<a href="http://pip.readthedocs.org/en/latest/index.html">pip</a> instalados.</p>
<p>Depois você faz o seguinte:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">python</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">suds.client</span> <span class="kn">import</span> <span class="n">Client</span>  <span class="c">#importa o cliente</span>
</pre></div>


<p>Aí você define a URL:</p>
<div class="highlight"><pre>&gt;&gt;&gt; url = &#39;http://www.camara.gov.br/SitCamaraWS/Proposicoes.asmx?wsdl&#39;
</pre></div>


<p>e acessa:</p>
<div class="highlight"><pre>&gt;&gt;&gt; client = Client(url)
</pre></div>


<p>Pronto! Você já tem acesso ao WebService. Agora você pode olhar os
métodos disponíveis de forma já tratada pelo suds:</p>
<div class="highlight"><pre>&gt;&gt;&gt; print (client)
</pre></div>


<p>Um dos métodos que ele mostra como disponíveis é esse:<br />
     ListarSiglasTipoProposicao()</p>
<p>Para consumí-lo, você faz o seguinte:</p>
<div class="highlight"><pre>&gt;&gt;&gt; resultado = client.service.ListarSiglasTipoProposicao()
</pre></div>


<p>O retorno é um xml composto pela tag <siglas> que possui vários objetos
<sigla> com atributos "tipoSigla", "descricao" e outros.</p>
<p>Se quiser ver o "tipoSigla" do terceiro item, você pode acessá-lo assim:</p>
<div class="highlight"><pre>&gt;&gt;&gt; resultado[&#39;siglas&#39;][&#39;sigla&#39;][2]._tipoSigla
</pre></div>


<p>E o retorno vai ser: </p>
<div class="highlight"><pre>ANEXO
</pre></div>


<p>Agora digamos que você quer saber quantas medidas provisórias estão em
tramitação no Congresso Nacional neste momento...</p>
<p>Você poderia utilizar o método ListarProposicoes. Nossa chamada "print
client" mostra este método da seguinte forma:</p>
<p>Methods (11):<br />
            ListarProposicoes(xs:string sigla, xs:string numero,
xs:string ano, xs:string datApresentacaoIni, xs:string
datApresentacaoFim, xs:string idTipoAutor, xs:string parteNomeAutor,
xs:string siglaPartidoAutor, xs:string siglaUFAutor, xs:string
generoAutor, xs:string codEstado, xs:string codOrgaoEstado, xs:string
emTramitacao, )</p>
<p>Olhando a <a href="http://www2.camara.leg.br/transparencia/dados-abertos/dados-abertos-legislativo/webservices/proposicoes-1/listarproposicoes">documentação do
método</a>,
você vai ver que alguns campos são obrigatórios. Um deles é o ano,
infelizmente. Então, para descobrir quantas medidas provisórias (de
qualquer ano) estão em tramitação no Congresso, você tem que fazer
várias chamadas como esta:</p>
<div class="highlight"><pre>&gt;&gt;&gt; resultado = client.service.ListarProposicoes(&#39;MPV&#39;, None, 2014, None, None, None, None, None, None, None, None, None, 1)
</pre></div>


<p>O 'MPV' no começo significa Medida Provisória e o 1 no final indica que
a proposição está tramitando. Para ver quantas deram você usa o seguinte
comando:</p>
<div class="highlight"><pre>&gt;&gt;&gt; len(resultado[&#39;proposicoes&#39;][&#39;proposicao&#39;])
</pre></div>


<p>Se quiser ver vários anos, pode executar o seguinte:</p>
<div class="highlight"><pre>&gt;&gt;&gt; for a in range(2005,2015):...    resultado = client.service.ListarProposicoes(&#39;MPV&#39;, None, a, None, None, None, None, None, None, None, None, None, 1)...    print(str(a) + &#39;: &#39; + str(len(resultado[&#39;proposicoes&#39;][&#39;proposicao&#39;])))...
</pre></div>


<p>Para minha surpresa, no momento em que fiz a consulta, havia 12
proposições do tipo Medida Provisória de 2014, e dezenas de outras de
outros anos. Na verdade, como vocês podem ver <a href="http://www.camara.gov.br/SitCamaraWS/Proposicoes.asmx/ListarSituacoesProposicao">em outra
consulta</a>,
quase todas as situações de proposições são consideradas "Ativas",
inclusive "Retirado pelo Autor", "Perdeu a Eficácia", "Enviada ao
Arquivo" e "Arquivada"... Acho que terei que montar meu próprio conceito
de "Ativa". Conto para vocês depois....</p>
<p>Abs.,Otávio </sigla></siglas></p>	
      
      <h3 class="blogMeta">Par <a href="#">Otávio Carneiro</a>, Catégorie : <a href="http://carneiro.blog.br/um/category/misc.html">misc</a></h3>
	<h3 class="blogMeta">Tags : </h3>
    
    </div><!-- end #blogItem -->
				
				<!-- end #content -->
  
  </div><!-- end #mainContent -->

<div class="clearfloat"></div>

  <div id="footer">
  
    <p><a href="http://css4free.com/" title="free CSS web site designs">Free CSS Gallery</a></p>
    <p>Orgulhosamente movido a <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, que roda em <a href="http://python.org">python</a>.
  </div><!-- end #footer -->

</div><!-- end #container -->
</body>
</html>